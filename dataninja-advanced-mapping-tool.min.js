/*! dataninja-advanced-mapping-tool 06-11-2014 */
head.ready(function(){function a(a,b){for(var c=1;c<b.length;c++)if(a<=b[c])return colorbrewer.Reds[b.length-1]?colorbrewer.Reds[b.length-1][c-1]:colorbrewer.Reds[3][c-1]}function b(b){var c=r.dl,d=K;return d.fillColor=a(parseInt(b.properties.data[q[c].binCol]),q[c].bins),d}function c(a){var b=a.target,c=b.feature.properties;P.setContent(c[p[r.dl].name]+"<br>Beni confiscati: "+c.data[q[r.dl].binCol]),P.setLatLng(b.getBounds().getCenter()),z.showLabel(P)}function d(a){a.target;P.close()}function e(a,b){var b=b||a.target;O.eachLayer(function(a){a.highlight=!1,O.resetStyle(a)}),b.highlight=!0,b.setStyle(M),r.i=b.feature.properties[p[r.dl].id],E.isAdded&&E.removeFrom(z),B.update(b.feature.properties),L.Browser.ie||L.Browser.opera||b.bringToFront()}function f(a,b){b.on({mouseover:c,mouseout:d,click:e})}function g(a){for(var b=(p[a].resource.features.length,q[a].resource.result.records.length),c=!0,d=0,e=0,f=0;f<p[a].resource.features.length;f++){for(var g=p[a].resource.features[f].properties[p[a].id],h=0;b>h;h++){var i=q[a].resource.result.records[h][q[a].id];if(i==g){d++,p[a].resource.features[f].properties.data=q[a].resource.result.records[h],c=!1;break}}c?(e++,p[a].resource.features.splice(f,1),f--):c=!0}}function h(a){var b=q[a].resource.result.records.map(function(b){return parseInt(b[q[a].binCol])}),c=new geostats(b);q[a].bins=c.getJenks(b.length>7?7:b.length-1),q[a].ranges=c.ranges,Q.update(a)}function i(a){if(d3.selectAll("nav#menu-ui a").classed("active",!1),d3.select("nav#menu-ui a#"+a).classed("active",!0),r.dl=a,O.clearLayers(),p[a].resource&&q[a].resource)O.addData(p[a].resource),delete r.i,E.isAdded&&E.removeFrom(z),B.update();else{var b=5e3,c="geo/"+(r.t?a+"-"+r.tl+"-"+r.t:a)+".json",d=k+"?resource_id="+q[a].resourceId+(r.t?"&filters["+o[r.tl].id+"]="+r.t:""),f=queue();if(z.spin(!0),f.defer(d3.json,c),f.defer(d3.json,d+"&limit="+b),r.mr&&r.mr.hasOwnProperty("rid")){var i=k+"?resource_id="+r.mr.rid;f.defer(d3.json,i+"&limit="+b)}f.await(function(b,c,d,f){if(p[a].resource=c,q[a].resource=d,q[a].markers=f||null,z.spin(!1),g(a),h(a),O.addData(p[a].resource),j||(j=d3.select(".leaflet-overlay-pane svg").attr("viewBox").split(" ")),r.t&&z.fitBounds(O.getBounds()),r.i&&O.eachLayer(function(b){b.feature.properties[p[a].id]==r.i&&e(null,b)}),q[a].markers){for(var i=new L.MarkerClusterGroup({showCoverageOnHover:!1}),k=[],l=q[a].markers.result.records,m=0;m<l.length;m++){var n=L.marker();n.setIcon(L.icon({iconUrl:"js/leaflet/marker-icon.png",shadowUrl:"js/leaflet/marker-shadow.png"})),n.setLatLng(L.latLng(l[m][r.mr.lat],l[m][r.mr.lng])),r.mr.hasOwnProperty("iw")&&n.bindPopup(l[m][r.mr.iw]),k.push(n),i.addLayer(n)}z.addLayer(r.mr.mc?i:L.layerGroup(k))}})}}var j,k="/api/confiscatibene/action/datastore/search.json",l="/api/dtnj/yourls-api.php",m=yourls.connect(l,{signature:"efe758b8d3"}),n={regioni:{id:"COD_REG",name:"NOME_REG",resource:null,list:[]},province:{id:"COD_PRO",name:"NOME_PRO",resource:null,list:[]},comuni:{id:"PRO_COM",name:"NOME_COM",resource:null,list:[]}},o={regioni:{id:"IdRegioneISTAT",resourceId:"e2f0c989-929f-4e4d-87e2-097140f8880f",resource:null,markers:null,binCol:"Totale beni",bins:[],ranges:[]},province:{id:"IdProvinciaISTAT",resourceId:"c18fa1ca-971f-4cfa-92e9-869785260dec",resource:null,markers:null,binCol:"Totale beni",bins:[],ranges:[]},comuni:{id:"IdComuneISTAT",resourceId:"69b2565e-0332-422f-ad57-b11491e33b08",resource:null,markers:null,binCol:"Totale beni",bins:[],ranges:[]}},p={},q={},r=Arg.query();r.ls=r.ls||d3.keys(n),r.ml=r.ls[0],r.dl=r.dl||r.ml,r.md=r.md||(head.mobile?"mobile":""),d3.select("body").classed(r.md,!0),r.t&&(r.tl=r.tl||r.ml,r.ml=r.ls[r.ls.indexOf(r.tl)+1],r.ls.indexOf(r.dl)<r.ls.indexOf(r.tl)+1&&(r.dl=r.ml)),r.mr&&r.mr.hasOwnProperty("rid")&&(r.mr.lat=r.mr.lat||"lat",r.mr.lng=r.mr.lng||"lng",r.mr.mc&&(r.mr.mc=parseInt(r.mr.mc)));for(var s=r.ls.indexOf(r.ml);s<r.ls.length;s++)n.hasOwnProperty(r.ls[s])&&o.hasOwnProperty(r.ls[s])&&(p[r.ls[s]]=n[r.ls[s]],q[r.ls[s]]=o[r.ls[s]]);var t=L.latLng(35.568,1.537),u=L.latLng(47.843,23.203),v=L.latLngBounds(t,u),w=L.latLng(22.472,-16.523),x=L.latLng(62.083,73.828),y=L.latLngBounds(w,x),z=L.map("map",{maxZoom:13,minZoom:5,scrollWheelZoom:!0,attributionControl:!1,maxBounds:y});z.fitBounds(v),L.tileLayer("/api/geoiq/{s}/{z}/{x}/{y}.png",{opacity:.7}).addTo(z),z.spin(!0);var A=L.control.attribution().addTo(z);A.addAttribution('Powered by <a href="http://www.dataninja.it/" target="_blank">Dataninja</a>'),A.addAttribution('tileset from <a href="http://www.geoiq.com/" target="_blank">GeoIQ</a>'),A.addAttribution('icons from <a href="http://www.flaticon.com/" target="_blank">Freepik</a> and <a href="http://www.simplesharebuttons.com/" target="_blank">Simple Share Buttons</a>'),A.addAttribution('geocoding by <a href="http://wiki.openstreetmap.org/wiki/Nominatim" target="_blank">OSM Nominatim</a>'),A.addAttribution('code on <a href="https://github.com/Dataninja/confiscatibene-choropleth" target="_blank">GitHub</a>.');var B;if("widget"===r.md?(B={},B._div=d3.select("body").append("div").attr("id","infowindow").classed("info",!0).node()):(B=L.control({position:"bottomright"}),B.onAdd=function(a){return this._div=L.DomUtil.create("div","info "+r.md),this._div.setAttribute("id","infowindow"),this._div.setAttribute("style","max-height:"+(head.screen.innerHeight-100)+"px;"),d3.select(this._div).on("mouseenter",function(){a.scrollWheelZoom.disable()}).on("mouseleave",function(){a.scrollWheelZoom.enable()}),this.update(),this._div}),B.update=function(a){if(this._div.innerHTML="",a){d3.select(this._div).classed("closed",!1),"mobile"===r.md&&z.dragging.disable();var b=agnes.rowDelimiter(),c=new Date,d=d3.time.format("%Y%m%d")(c),e=r.dl,f=q[e].id,g=a[p[e].id],h="e5b4d63a-e1e8-40a3-acec-1d351f03ee56",i="Condividi la situazione"+("regioni"==e?" in ":" a ")+a[p[e].name],j="http://"+location.hostname+Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&"),l="http://"+location.hostname+encodeURIComponent(Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&")),n=a[p[e].name],o=['<a class="ssb" href="http://twitter.com/share?url='+l+"&via=confiscatibene&text="+encodeURIComponent(n+", immobili e aziende #confiscatibene ")+'" target="_blank" title="'+i+' su Twitter"><img src="img/twitter.png" id="ssb-twitter"></a>','<a class="ssb" href="http://www.facebook.com/sharer.php?u='+l+'" target="_blank" title="'+i+' su Facebook"><img src="img/facebook.png" id="ssb-facebook"></a>','<a class="ssb" href="https://plus.google.com/share?url='+l+'" target="_blank" title="'+i+' su Google Plus"><img src="img/gplus.png" id="ssb-gplus"></a>','<a class="ssb" href="http://www.linkedin.com/shareArticle?mini=true&url='+l+'" target="_blank" title="'+i+' su LinkedIn"><img src="img/linkedin.png" id="ssb-linkedin"></a>','<a class="ssb" href="mailto:?Subject='+encodeURIComponent("Confiscati Bene | "+n)+"&Body="+encodeURIComponent(n+", gli immobili e le aziende #confiscatibene: ")+l+'" target="_blank" title="'+i+' per email"><img src="img/email.png" id="ssb-email"></a>','<a class="ssb" href="'+j+'" target="_blank" title="Permalink"><img src="img/link.png" id="ssb-link"></a>'],s=['<a id="a-immobili" class="dnl" href="#" title="Scarica l\'elenco degli immobili"><img src="img/house109-dnl.png" /></a>','<a id="a-aziende" class="dnl" href="#" title="Scarica l\'elenco delle aziende"><img src="img/factory6-dnl.png" /></a>'],t='<table class="zebra"><thead><tr><th><span id="sdnlBtn">'+s.join("&nbsp;")+'</span>&nbsp;&nbsp;<span id="sshrBtn">'+o.join("&nbsp;")+'</span></th><th style="text-align:right;"><a id="close-cross" href="#" title="Chiudi"><img src="img/close.png" /></a></th></tr><tr><th colspan="2" class="rossobc">'+a[p[e].name]+'</th></tr></thead><tfoot><tr><td colspan="2" style="text-align:right;font-size: smaller;">Creative Commons Attribution <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY 4.0 International</a>.</td></tr></tfoot><tbody>';for(var u in a.data)a.data.hasOwnProperty(u)&&"0"!=a.data[u]&&u.charAt(0)==u.charAt(0).toUpperCase()&&"Id"!=u.slice(0,2)&&(t+="<tr><td>"+(u.indexOf("Totale")>-1?"<b>"+u+"</b>":u)+"</td><td>"+(u.indexOf("Totale")>-1?"<b>"+parseInt(a.data[u])+"</b>":parseInt(a.data[u])||a.data[u])+"</td></tr>");t+="</tbody></table>",this._div.innerHTML+=t,m.shorten(l,"confiscatibene-"+md5(j),function(a){var b=a.shorturl,c=['<a class="ssb" href="http://twitter.com/share?url='+b+"&via=confiscatibene&text="+encodeURIComponent(n+", immobili e aziende #confiscatibene ")+'" target="_blank" title="'+i+' su Twitter"><img src="img/twitter.png" id="ssb-twitter"></a>','<a class="ssb" href="http://www.facebook.com/sharer.php?u='+b+'" target="_blank" title="'+i+' su Facebook"><img src="img/facebook.png" id="ssb-facebook"></a>','<a class="ssb" href="https://plus.google.com/share?url='+b+'" target="_blank" title="'+i+' su Google Plus"><img src="img/gplus.png" id="ssb-gplus"></a>','<a class="ssb" href="http://www.linkedin.com/shareArticle?mini=true&url='+b+'" target="_blank" title="'+i+' su LinkedIn"><img src="img/linkedin.png" id="ssb-linkedin"></a>','<a class="ssb" href="mailto:?Subject='+encodeURIComponent("Confiscati Bene | "+n)+"&Body="+encodeURIComponent(n+", gli immobili e le aziende #confiscatibene: ")+b+'" target="_blank" title="'+i+' per email"><img src="img/email.png" id="ssb-email"></a>','<a class="ssb" href="'+j+'" target="_blank" title="Permalink"><img src="img/link.png" id="ssb-link"></a>'];d3.select("#sshrBtn").node().innerHTML=c.join("&nbsp;")});var v=k+"?resource_id="+h+"&limit=5000&filters["+f+"]="+g;d3.select("a#a-immobili").on("click",function(){d3.json(v,function(a,c){if(c.result.records.length>0){var e=agnes.jsonToCsv(c.result.records,b),h=new Blob([e],{type:"text/csv;charset=utf-8"}),i=d+"_confiscatibene_immobili_"+f+"-"+g+".csv";saveAs(h,i)}else alert("No data!")})});d3.select("a#a-aziende").on("click",function(){d3.json(v,function(a,c){if(c.result.records.length>0){var e=agnes.jsonToCsv(c.result.records,b),h=new Blob([e],{type:"text/csv;charset=utf-8"}),i=d+"_confiscatibene_aziende_"+f+"-"+g+".csv";saveAs(h,i)}else alert("No data!")})}),d3.select(this._div).select("a#close-cross").on("click",function(){return O.eachLayer(function(a){a.highlight=!1,O.resetStyle(a)}),delete r.i,E.isAdded&&E.removeFrom(z),B.update(),!1})}else d3.select(this._div).classed("closed",!0),"mobile"===r.md?(z.dragging.enable(),this._div.innerHTML+='<a href="mailto:info@confiscatibene.it" target="_blank" style="margin-right: 30px;">Info</a>'):this._div.innerHTML+='<p>La mappa mostra il numero di beni confiscati per tutti i territori amministrativi italiani, secondo i dati ufficiali dell\'<a href="http://www.benisequestraticonfiscati.it" target="_blank">ANBSC</a> (sono esclusi i beni non confiscati in via autonoma). La corrispondenza tra il gradiente di colore e il numero complessivo di beni confiscati è dato nella legenda in basso a sinistra.</p><p>Mediante il selettore in alto a sinistra si possono caricare e visualizzare ulteriori livelli (regioni, province, comuni).</p><p>Principali funzioni della mappa: <ul><li>cerca i dati relativi al tuo territorio cliccando sulla lente e inserendo il nome di un comune;</li><li>clicca sul territorio per visualizzare i dati in dettaglio, la composizione dei beni e per scaricarne la lista completa;</li><li>includi la vista corrente della mappa sul tuo sito con il codice di embed o scaricane uno screenshot (pulsanti in alto a destra).</li></ul></p><p>Tieniti aggiornato sul progetto visitando il sito ufficiale di <a href="http://www.confiscatibene.it" target="_blank">Confiscati Bene</a> o seguendo l\'account Twitter <a href="https://twitter.com/confiscatibene" target="_blank">@confiscatibene</a>, puoi anche scriverci all\'indirizzo <a href="mailto:info@confiscatibene.it" target="_blank">info@confiscatibene.it</a>.</p>'},"widget"===r.md?B.update():B.addTo(z),"widget"!=r.md&&"embed"!=r.md){L.control.fullscreen({title:"Fullscreen mode"}).addTo(z)}var C;"widget"===r.md?C=d3.select("body").insert("div","#map").attr("id","logo-widget").append("a").classed("logo "+r.md,!0).attr("href","http://www.confiscatibene.it/").attr("target","_blank").append("img").attr("id","logo").attr("src","img/logo.png"):(C=L.control({position:"topleft"}),C.onAdd=function(){var a=L.DomUtil.create("a","logo "+r.md),b=L.DomUtil.create("img","logo",a);return a.setAttribute("href","http://www.confiscatibene.it/"),a.setAttribute("target","_blank"),b.setAttribute("id","logo"),b.setAttribute("src","img/logo.png"),a},C.addTo(z));var D=L.control({position:"mobile"===r.md?"bottomleft":"topright"});D.onAdd=function(a){var b=L.DomUtil.create("img","reset "+r.md);return b.setAttribute("src","img/reset.png"),b.setAttribute("title","Reset"),d3.select(b).on("click",function(){i(r.ml),a.fitBounds(v)}),b},D.addTo(z);var E=L.control({position:"mobile"===r.md?"bottomleft":"topright"});E.isAdded=!1,E.onRemove=function(){this.isAdded=!1},E.onAdd=function(){this.isAdded=!0;var a={},b=r.md,c=L.DomUtil.create("div","info embed-inputarea"),d="http://"+location.hostname+Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&"),e="http://"+location.hostname+encodeURIComponent(Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&"));a.permalink=L.DomUtil.create("p","permalink",c),a.shorturl=L.DomUtil.create("p","shorturl",c),a.iframe=L.DomUtil.create("p","iframe",c),a.widget=L.DomUtil.create("p","widget",c),a.shortcode=L.DomUtil.create("p","shortcode",c),a.svg=L.DomUtil.create("p","svg",c),a.permalink.innerHTML='<label for="embed-permalink" title="Clicca per selezionare">Permalink:</label>&nbsp;<input type="text" id="embed-permalink" value="'+d+'" readonly></input>',a.shorturl.innerHTML='<label for="embed-shorturl" title="Clicca per selezionare">Short URL:</label>&nbsp;<input type="text" id="embed-shorturl" value="Not available..." disabled readonly></input>',m.shorten(e,"confiscatibene-"+md5(d),function(a){d3.select("input#embed-shorturl").attr("value",a.shorturl).attr("disabled",null)}),r.md="embed",a.iframe.innerHTML='<label for="embed-iframe" title="Clicca per selezionare">Embed in post/page:</label>&nbsp;<input type="text" id="embed-iframe" value="<iframe src=&quot;'+d+'&quot; frameborder=&quot;0&quot; allowtransparency=&quot;true&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen width=&quot;100%&quot; height=&quot;700&quot;></iframe>" readonly></input>',r.md="widget",a.widget.innerHTML='<label for="embed-widget" title="Clicca per selezionare">Embed in sidebar:</label>&nbsp;<input type="text" id="embed-widget" value="<iframe src=&quot;'+d+'&quot; frameborder=&quot;0&quot; allowtransparency=&quot;true&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen width=&quot;100%&quot; height=&quot;755&quot;></iframe>" readonly></input>',r.md="embed",a.shortcode.innerHTML='<label for="embed-shortcode" title="Clicca per selezionare">WP Shortcode (<a href="https://github.com/Dataninja/wp-cbmap-shortcode" target="_blank">?</a>):</label>&nbsp;<input type="text" id="embed-shortcode" value="[cbmap '+decodeURIComponent(Arg.url(r).replace(/^[^?]+\?/,"").replace(/&/g," "))+']" readonly></input>',r.md=b,a.svg.innerHTML='<label for="embed-svg" title="Copia/incolla il codice o scaricalo cliccando sull\'immagine">Scalable Vector Graphics:</label>&nbsp;<textarea id="embed-svg" readonly>'+d3.select(".leaflet-overlay-pane")[0][0].innerHTML.replace(/\>/g,">\n")+'</textarea>&nbsp;<img src="img/svg.png" title="Scarica l\'immagine in SVG">';for(var f in a)a.hasOwnProperty(f)&&d3.select(a[f]).select("input").on("focus",function(){this.select()});return d3.select(a.svg).select("img").on("click",function(){var a=new Blob([d3.select(".leaflet-overlay-pane")[0][0].innerHTML.replace(/\>/g,">\n")],{type:"image/svg+xml;charset=utf-8"}),b="confiscatibene_map.svg";saveAs(a,b)}),c};var F=L.control({position:"mobile"===r.md?"bottomleft":"topright"});if(F.onAdd=function(a){var b=L.DomUtil.create("img","embed "+r.md);return b.setAttribute("src","img/embed.png"),b.setAttribute("title","Embed this map"),d3.select(b).on("click",function(){E.isAdded?E.isAdded&&E.removeFrom(a):E.addTo(a)}),b},F.addTo(z),"widget"!=r.md){var G=L.control({position:"mobile"===r.md?"bottomleft":"topright"});G.onAdd=function(){var a=L.DomUtil.create("img","screenshot "+r.md);return a.setAttribute("id","screenshot"),a.setAttribute("src","img/screenshot.png"),a.setAttribute("title","Take a screenshot"),d3.select(a).on("click",function(){html2canvas(document.body,{onrendered:function(a){var b=d3.select(".leaflet-overlay-pane svg");canvg(a,b.node().outerHTML,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:j[0],offsetY:j[1]}),a.toBlob(function(a){saveAs(a,"confiscatibene_map.png")})}})}),a},G.addTo(z)}if("embed"===r.md||"widget"===r.md){var H=L.control({position:"topright"});H.onAdd=function(){var a=L.DomUtil.create("a","detach "+r.md),b=L.DomUtil.create("img","detach",a);return a.setAttribute("href",Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&")),a.setAttribute("target","_blank"),a.setAttribute("title","Open in new window"),b.setAttribute("id","detach"),b.setAttribute("src","img/detach.png"),d3.select(a).on("click",function(){this.setAttribute("href",Arg.url(r).replace(/&*md=[^&]*/,"").replace(/&{2,}/g,"&"))}),a},H.addTo(z)}if(!r.md){var I=L.control({position:"bottomleft"});I.onAdd=function(){var a=L.DomUtil.create("div","share "+r.md);a.setAttribute("id","buttons");var b='<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://'+location.hostname+location.pathname+'" data-via="confiscatibene" data-lang="it" data-related="jenkin27:Data scientist at Dataninja" data-hashtags="confiscatibene,dataninja" data-count="vertical">Tweet</a>',c='<div class="fb-like" style="overflow:hidden;" data-href="http://'+location.hostname+location.pathname+'" data-layout="box_count" data-action="like" data-show-faces="false" data-share="false"></div>',d='<div class="g-plusone" data-size="tall" data-href="http://'+location.hostname+location.pathname+'" data-annotation="bubble"></div>';return a.innerHTML=b+c+d,head.load("https://platform.twitter.com/widgets.js").load("http://connect.facebook.net/it_IT/sdk.js#xfbml=1&appId=470290923072583&version=v2.0").load("https://apis.google.com/js/plusone.js"),a},I.addTo(z)}var J=L.control({position:"topleft"});J.onAdd=function(){var a=L.DomUtil.create("nav","menu-ui "+r.md);return a.setAttribute("id","menu-ui"),"widget"===r.md&&a.setAttribute("style","display:none;"),a},J.addTo(z);var K={weight:.5,opacity:1,color:"white",fillOpacity:.7,fillColor:"none"},M={weight:2,color:"#666"};if("widget"!=r.md&&"mobile"!=r.md){var N=new L.Control.OSMGeocoder({collapsed:!0,position:"topleft",text:"Cerca il tuo comune",bounds:v,email:"jenkin@dataninja.it",callback:function(a){if(a.length){var b=a[0].boundingbox,c=new L.LatLng(b[0],b[2]),d=new L.LatLng(b[1],b[3]),e=new L.LatLngBounds([c,d]);delete r.i,E.isAdded&&E.removeFrom(z),B.update(),i("comuni"),this._map.fitBounds(e,{maxZoom:10})}}});z.addControl(N),N._completely=completely(N._input),N._completely.onChange=function(a){N._completely.startFrom=a.lastIndexOf(" ")+1,N._completely.repaint()},N._completely.input.maxLength=50,d3.json(r.t?"geo/lista_comuni-"+r.t+".json":"geo/lista_comuni.json",function(a,b){n.comuni.list=b,N._completely.options=n.comuni.list.map(function(a){return a[p.comuni.name]})})}var O,P=new L.Label;O=L.geoJson("",{style:b,onEachFeature:f}).addTo(z);var Q=L.control({position:"bottomleft"});Q.onAdd=function(){return this._div=L.DomUtil.create("div","info legend "+r.md),this._div.innerHTML="widget"!=r.md?"<h4>Legenda</h4>":"",this._div},Q.update=function(a){var b=q[a].ranges;this._div.innerHTML="widget"!=r.md?'<h4 title="Numero totale di beni confiscati">Legenda</h4>':"";for(var c=0;c<b.length;c++){var d=colorbrewer.Reds[b.length]?colorbrewer.Reds[b.length][c]:colorbrewer.Reds[3][c];this._div.innerHTML+='<i title="Tra '+b[c].replace("-","e")+' beni confiscati" style="background:'+d+'"></i> '+("widget"!=r.md?b[c]:"")+"<br>"}"widget"!=r.md&&(this._div.innerHTML+="<br>Numero totale<br>di beni confiscati")},Q.addTo(z),d3.select("nav#menu-ui").selectAll("a").data(d3.keys(n)).enter().append("a").attr("href","#").attr("id",function(a){return a}).classed("disabled",function(a){return!p.hasOwnProperty(a)}).on("click",function(a){p.hasOwnProperty(a)&&(delete r.i,E.isAdded&&E.removeFrom(z),B.update(),i(a))}).text(function(a){return a}),setTimeout(function(){z.spin(!1),i(r.dl)},3e3)});